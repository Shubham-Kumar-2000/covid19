<!DOCTYPE html>
<html>
  <head>
    <title>Graph</title>
    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.js"></script>
    <link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <style>
      path.domain { stroke: white; }
.tick text { stroke: white;
  stroke-width: 1px; }
.c3-legend-item text { stroke: white; }
.c3 text {
  stroke: white;
  stroke-width: 1px;
}
    </style>
  </head>
  <body style="background-color: azure;">
    
    <div id='bg' style="height: 543px; width: 786px;overflow: hidden; background: #1d032b;">
      <br/>
      <center><img style="display:inline;height: 30px;position: relative;
        top: 5px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARMAAAC3CAMAAAAGjUrGAAAAmVBMVEX/mTMSiAf/////lycAgQAAAIgAAIUAAH4AAIIAAIMAAHwAAHPi4u+kpMvz8/kAAHjn5/Lt7fXd3ey5uddPT6GZmcWDg7n6+v7Ly+HIyOJERJxlZao+PponJ5L29vy0tNbW1uggIJCfn8iGhrsYGJBNTaB2drQQEIx+fripqc5ra62QkMBXV6QiIpFfX6i+vtwyMpw6Opg1NZe0gadDAAAEvUlEQVR4nO3ba3OiSBiG4UzvdDcip8YDiAdQZAIxExP//4/btzHjZH1Nze6HpVPlc1Ul0eiH9g7Q2JKHBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACA/+gvuPYg4BqacGjCoQmHJhyacF+hSTI5LFd7uV8tD5PE9WDEF2gSHNbaGyklpVRq5Omfh8D1kBw3qaZ6pCiGVFrr/oYc6SZ3OyinTZIpdZCeevnhNyY1jf/jRXm0vejG6S7kssnObhmeNxMbcTSiEuZIt2aeZ7eancNxOWzy7NFrn3cnI/p9pbTfcmFO3ZxaeVN3A3PWJNrS5lAEmb3d5wgvt7KgoMe2kauhuWoSPdK2QHvIwt5ZpPTtQF/p+S7tVbQNPbqK4qhJRluJ17VGZB3di2yPF/o62AxdJkzbUZRt5mZwjpo0lOTY3wrtFGMPHq/vP5N+JxJHiuLomOKmycyTXinOUewLX1IYSTmW7/cpiSjpOTMno3PSJNA049TnQ4gIae8J6cVrSkWbSNdvJvRITbOPdnJO66RJo1QzM3RjaY8YMhLVVmR+JraViGhzEZn9vZnZp7kYnosmCy31+UR180oH1a4QWWyiODJxJhqajaPTpn80oee5OM130WSlVL3pZ11hJO0daiLWITUJ12KiaM+Spn9ssamVKhyMz0GTVNsDrOi6/o5fiVKLdmVis2qFLkXl27OV/rhCh1mdDj9AB01qmoftnz+Z2ir5+Cjk08JP49RfPElxHNvdpZvao2vhyVE9/AAdNHmkOfZ8ihpK2l4m4y4fJ7ryKp2M8248oe1D7vrHDc3Z++EHOHwTmojlr9tRISciHB/beZ3v87puj+OdmMiV+fUE6WI6Hr5J6amnaFEuzptK6av8GAfrKmzDah3Ex/zR798Iik1e5tGT8srBRzh8k7lSLf1ID9NlWNF5yHLcBuugLd6KNl0H87E9N0m7p+Zgj66tUvPBRzh8k2cl/fNZRzLbxut2kczXaWFXIEdFsG6TfH6KH2fnPSb3pXoefITDN3lVanpZBTDhytd12o6kNWrTg/ZPu8vKYzRV6nXwEQ7fRErvkiSLIpNWeViovokqdnmVmii6LBJE3u8D8mCcNEmqYzhbnqT2/TiOvX37Js/e6q1Hv4l9LX8+H8IyT++mCbaTK1fHkzccTz7OO8Hveafp550mWM/vct6Zn085cH7ywe3z2JTOY9O7PY/F+50b9vS++PyiP3tfPLm398WiHv15/aTs109Wd7N+gnW2G4p/uR6b3c96rMiv1u2bT9btgztat+8/3zmY989xbn6+I+7t8x18DngLPi++YYrrChhcf3IDrlO6IdqOpCpSXM/2D/11j234yXWPwy+bXOD6WO5rXkc9vdvrqAWut78N/5dx08f/3zF/fvr/7is0+WrQhEMTDk04NOHQhHv4DtcevsE1NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMTDk04NOHQhEMT7m/cNifkUwM0UQAAAABJRU5ErkJggg==" />
        <h2 style="color: #c3b8ff;display: inline;">INDIA COVID-19 Case(s) of last 15 Days</h2>
      <img style="display:inline;height: 30px;position: relative;
      top: 5px;" src="https://images.newscientist.com/wp-content/uploads/2020/02/11165812/c0481846-wuhan_novel_coronavirus_illustration-spl.jpg"/></center><br/>
      <div style="margin: 5px;"><div id="chart" ></div></div>
      <br/>
      <div style="position: relative;">
      <img style="display:inline;height: 100px;position: absolute;
        top: 0px;left: 0px;" src="/logo.png"/>
        <h3 style="height: 100px;position: absolute;
        top: 10px;right: 0px;color:#90dabf;display: inline;margin: 5px;">#Stay_At_Home<br/>#Stay_Safe<br/>#With_Me</h3>
        <div style="margin-left: 100px;padding-top: 9px;">
          <h1 style="color: #ff5959;display: inline;margin: 5px;">COVID-19 Informer</h1>
          <p style="margin:5px; color: white; font-size: 12px;" >A WhatsApp service keeping thousands of users UPDATED about covid-19<br/>Send 'Hi' on WhatsApp to <i style="font-weight: 700;">+91 98748 89908</i> to get updates.</p>
        </div>
        <span style="color: lightgray; margin-left: 10px;">team_DSA</span>
      </div>

    <p id='jsondata' style="display: none;"><%= data %></p>
  </div>
  <script>
    function formatDate(date){
        var dd = date.getDate();
        var mm = date.getMonth()+1;
        var yyyy = date.getFullYear();
        if(dd<10) {dd='0'+dd}
        if(mm<10) {mm='0'+mm}
        date = yyyy+'-'+mm+'-'+dd;
        return date
    }



    function LastnDays (n=15) {
        var result = [];
        for (var i=0; i<n; i++) {
            var d = new Date();
            d.setDate(d.getDate() - i);
            result.push( formatDate(d) )
        }
        return result.reverse();
    }
    let data=document.getElementById('jsondata').innerHTML;
    console.log(data)
    data=JSON.parse(data)
    let con=["Confirmed"],rec=["Recovered"],dead=["Deaths"];
    con.push(...data.map(record=>{
      return record.con
    }).reverse())
    rec.push(...data.map(record=>{
      return record.rec
    }).reverse())
    dead.push(...data.map(record=>{
      return record.dead
    }).reverse())
    let render= async function(){
      let colours=['#6e5a0a','#095f61','#000000','#610955','#4d5e08','#140857','#824703'];
      document.getElementById('bg').style.backgroundColor=colours[Math.floor(Math.random() * colours.length)]
    let xData = ['x',...LastnDays()]
    var chart =await c3.generate({
      bindto: '#chart',
      data: {
        x:'x',
          columns: [
            xData,
              con,
              rec,dead
          ],
          types: {
            Confirmed: 'area-spline',
            Recovered: 'area-spline',
            Deaths: 'area-spline'
          },
          colors: {
            Confirmed: 'white',
            Recovered: 'green',
            Deaths: 'red'
          },
          line: {
            connectNull: true,
            step: {
              type: 'step-after'
            }
          },
          labels: {
              format: function (v, id, i, j) { return v; }
            
            }
      },
      axis: {
        x: {
            label: 'Last 15 Days',
            type: 'timeseries',
            tick: {
                format: '%Y-%m-%d'
            }
        },
        y: {
            label: 'COVID-19 Caes(s)'
        }
    }
    })
    $( "body" ).append("<h1 style='position:fixed;top:0px;left:0px;' id='shu'></h1>")
    }
    render()
  </script>
  </body>
</html>
